# كيفية ظهور سكشن "المشروعات ذات الصلة"

يعتمد ظهور سكشن "المشروعات ذات الصلة" في صفحة المشروع الفردي على مجموعة من العوامل داخل الدالة `get_my_related_projects()`:

1. **الفئة الرئيسية للمشروع**
   - يتم قراءة قيمة الحقل المخصَّص `jawda_main_category_id` للمشروع الحالي، ولا يتم تنفيذ أي استعلامات إلا إذا كانت القيمة موجودة.

2. **الموقع الجغرافي للمشروع**
   - يتم استخدام معرفات الحي (`loc_district_id`)، والمدينة (`loc_city_id`)، والمحافظة (`loc_governorate_id`) الخاصة بالمشروع الحالي للبحث عن مشروعات أخرى تشترك في نفس البيانات.

3. **ترتيب الاستعلامات وحدّ النتائج**
   - يتم البحث أولًا عن مشروعات بنفس الحي حتى حد أقصى خمسة عناصر.
   - إذا لم يكتمل الحدّ الأقصى، يتم استكمال العدد من نفس المدينة، ثم من نفس المحافظة عند الحاجة.

4. **مشروعات أخرى في نفس المدينة**
   - بعد جمع المشروعات المشابهة، يتم تنفيذ استعلام آخر لجلب مشروعات أخرى من نفس المدينة (حتى خمسة عناصر) مع استبعاد المشروع الحالي وأي عناصر سبق عرضها.

5. **شرط عرض السكشن**
   - لا يتم طباعة السكشن إلا إذا وُجدت نتائج في أي من القائمتين `$similar_project_ids` أو `$other_city_project_ids`.

6. **عناوين السكشن**
   - يتم جلب اسم الفئة الرئيسية من جدول `property_categories` واسم المدينة من جدول `locations_cities` لعرض العناوين المناسبة باللغة الحالية للموقع.

بمجرد تحقق أي من الشروط المذكورة أعلاه وتوافر بيانات أخرى تشترك مع المشروع الحالي، سيظهر سكشن "المشروعات ذات الصلة" ويعرض البطاقات المناسبة.
