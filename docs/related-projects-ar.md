# كيفية ظهور سكشن "المشروعات ذات الصلة"

يعتمد ظهور سكشن "المشروعات ذات الصلة" في صفحة المشروع الفردي على خطوات واضحة داخل الدالة `get_my_related_projects()`:

1. **الفئة الرئيسية شرط أساسي**
   - تتم قراءة قيمة الحقل `jawda_main_category_id` للمشروع الحالي، ولا يتم تنفيذ أي استعلامات إن لم تكن القيمة موجودة.

2. **تجميع كل مشروعات الفئة**
   - يتم تنفيذ استعلام واحد لجلب جميع مشروعات نفس الفئة الرئيسية مرتبة من الأحدث إلى الأقدم، مع الاقتصار على المعرفات فقط للحفاظ على الأداء.

3. **اختيار أقرب خمسة مشروعات**
   - بعد تحديد موضع المشروع الحالي داخل القائمة الكاملة، يبدأ القالب في أخذ المشروعات التالية مباشرة (الأقدم زمنًا) حتى يصل إلى خمسة عناصر أو ينفد المحتوى.
   - إذا لم يكن هناك ما يكفي من المشروعات الأقدم، يتم الالتفاف تلقائيًا إلى بداية القائمة (أحدث المشروعات) لاستكمال العدد المطلوب.
   - مثال: عند وجود عشرة مشروعات إجمالًا وكان المشروع الحالي هو الثالث زمنيًا، سيأخذ السكشن المشروعين الأقدم أولًا (رقم 1 و2)، ثم يلتف ليضيف ثلاثة مشروعات من بداية القائمة (مثل 10 و9 و8) ليحافظ على خمس بطاقات.

4. **عرض النتائج**
   - يُنشئ القالب السكشن عندما تحتوي القائمة النهائية على أي عناصر، ويعرض عنوانًا ديناميكيًا متبوعًا ببطاقات المشروعات المختارة (أو بعدد أقل إذا لم تتوافر سوى هذه العناصر).

5. **مصدر عنوان السكشن**
   - يتم استخدام `jawda_main_category_id` لجلب اسم الفئة الرئيسية من جدول `property_categories` باستخدام اللغة الحالية لواجهة الموقع، ثم توليد عنوان مثل "مشروعات [اسم الفئة] السابقة" في الواجهة العربية أو "Previous [Category] projects" في الواجهة الإنجليزية.

ما دامت هناك مشروعات أخرى ضمن نفس الفئة الرئيسية، سيظهر السكشن ويعرض المشروعات الأقرب زمنيًا إلى المشروع الحالي مع مراعاة الدوران على بقية اللوب عند الحاجة لاستكمال العدد.
