# كيفية ظهور سكشن "المشروعات ذات الصلة"

يعتمد ظهور سكشن "المشروعات ذات الصلة" في صفحة المشروع الفردي على مجموعة من العوامل داخل الدالة `get_my_related_projects()`:

1. **الفئة الرئيسية للمشروع**
   - يتم قراءة قيمة الحقل المخصَّص `jawda_main_category_id` للمشروع الحالي، ولا يتم تنفيذ أي استعلامات إلا إذا كانت القيمة موجودة.

2. **الموقع الجغرافي للمشروع**
   - يتم استخدام معرفات الحي (`loc_district_id`)، والمدينة (`loc_city_id`)، والمحافظة (`loc_governorate_id`) الخاصة بالمشروع الحالي للبحث عن مشروعات أخرى تشترك في نفس البيانات.

3. **ترتيب الاستعلامات وحدّ النتائج**
   - يتم البحث أولًا عن مشروعات بنفس الحي حتى حد أقصى خمسة عناصر.
   - إذا لم يكتمل الحدّ الأقصى، يتم استكمال العدد من نفس المدينة، ثم من نفس المحافظة عند الحاجة.

4. **مشروعات أخرى في نفس المدينة**
   - بعد جمع المشروعات المشابهة، يتم تنفيذ استعلام آخر لجلب مشروعات أخرى من نفس المدينة (حتى خمسة عناصر) مع استبعاد المشروع الحالي وأي عناصر سبق عرضها.

5. **شرط عرض السكشن**
   - يتم تخزين نتائج الاستعلامات السابقة في القائمتين `$similar_project_ids` و`$other_city_project_ids`. إذا بقيت القائمتان فارغتين بعد تنفيذ الاستعلامات، فلن يتم إنشاء أي HTML، وبالتالي لن يظهر السكشن على الصفحة.

6. **عناوين السكشن**
   - يستخدم القالب المعرّف `jawda_main_category_id` لجلب اسم الفئة الرئيسية من جدول `property_categories`، ويستعلم عن اسم المدينة من جدول `locations_cities`. تُستخدم هذه الأسماء لترجمة العناوين إلى لغة واجهة الموقع الحالية حتى يظهر العنوان بصيغة مفهومة مثل "مشروعات ذات صلة في فئة…" أو "مشروعات أخرى في مدينة…".

عندما تُعيد الاستعلامات أي نتائج (أي عندما تحتوي إحدى القائمتين على عناصر) مع توفر بيانات الفئة الرئيسية والموقع، يتم إنشاء السكشن وعرض بطاقات المشروعات المطابقة للمستخدم.
