# كيفية ظهور سكشن "المشروعات ذات الصلة"

يعتمد ظهور سكشن "المشروعات ذات الصلة" في صفحة المشروع الفردي على خطوات واضحة داخل الدالة `get_my_related_projects()`:

1. **الفئة الرئيسية شرط أساسي**
   - تتم قراءة قيمة الحقل `jawda_main_category_id` للمشروع الحالي، ولا يتم تنفيذ أي استعلامات إن لم تكن القيمة موجودة.

2. **تجميع المشروعات الأقدم أولًا**
   - يتم تنفيذ استعلام لجلب حتى خمسة مشروعات من نفس الفئة الرئيسية نُشرت قبل تاريخ نشر المشروع الحالي مباشرة، مع ترتيبها من الأحدث إلى الأقدم ضمن هذه القائمة.

3. **الإكمال بالعودة إلى بداية اللوب**
   - إذا كان عدد المشروعات الأقدم أقل من خمسة (مثل حالة مشروع في بداية التسلسل الزمني حيث لا يوجد أمامه إلا مشروع أو اثنان)، يتم تنفيذ استعلام ثانٍ لجلب مشروعات أحدث من المشروع الحالي من نفس الفئة الرئيسية لاستكمال العدد المطلوب. يتم البدء بأحدث المشروعات المنشورة لضمان أن تكون النتيجة النهائية خمس بطاقات قدر الإمكان.
   - مثال: عند وجود عشرة مشروعات إجمالًا وكان المشروع الحالي هو الثالث زمنيًا، سيجد الاستعلام الأول مشروعين فقط (رقم 1 و2)، ثم يستكمل العدد بثلاثة مشروعات من نهاية اللوب (مثل 10 و9 و8).

4. **عرض النتائج**
   - يُنشئ القالب السكشن عندما تحتوي القائمة النهائية على أي عناصر، ويعرض عنوانًا ديناميكيًا متبوعًا ببطاقات المشروعات الخمسة (أو بعدد أقل إذا لم تتوافر سوى هذه العناصر).

5. **مصدر عنوان السكشن**
   - يتم استخدام `jawda_main_category_id` لجلب اسم الفئة الرئيسية من جدول `property_categories` باستخدام اللغة الحالية لواجهة الموقع، ثم توليد عنوان مثل "مشروعات [اسم الفئة] السابقة" في الواجهة العربية أو "Previous [Category] projects" في الواجهة الإنجليزية.

ما دامت هناك مشروعات أخرى ضمن نفس الفئة الرئيسية، سيظهر السكشن ويعرض المشروعات الأقرب زمنيًا إلى المشروع الحالي مع مراعاة الدوران على بقية اللوب عند الحاجة لاستكمال العدد.
