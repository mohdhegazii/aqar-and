# كيفية ظهور سكشن "المشروعات ذات الصلة"

يعتمد ظهور سكشن "المشروعات ذات الصلة" في صفحة المشروع الفردي على خطوات واضحة داخل الدالة `get_my_related_projects()`:

1. **الفئة الرئيسية شرط أساسي**
   - تتم قراءة قيمة الحقل `jawda_main_category_id` للمشروع الحالي، ولا يتم تنفيذ أي استعلامات إن لم تكن القيمة موجودة.

2. **فلترة بحسب الموقع والفئة**
   - يتم إعداد استعلام أساسي يشترط أن تنتمي النتائج لنفس الفئة الرئيسية (`jawda_main_category_id`) مع استبعاد المشروع الحالي.
   - بعدها يتم تنفيذ سلسلة من الاستعلامات الصغيرة حسب مستويات الموقع (الحي ثم المدينة ثم المحافظة) لجلب مشروعات تشترك في نفس المستوى الجغرافي مع المشروع الحالي.

3. **اختيار خمسة مشروعات منشورة قبل المشروع الحالي**
   - يبدأ القالب بمحاولة جلب حتى خمسة عناصر منشورة قبل تاريخ المشروع الحالي من نفس الحي، وإن لم يكتمل العدد ينتقل للمدينة ثم للمحافظة مع الحفاظ على الترتيب الزمني التنازلي.
   - هذا الأسلوب يضمن أن كل صفحة مشروع تربط بالمشروعات الأقرب لها مكانًا وزمانًا، ما يقلل احتمالات وجود صفحات لا تشير إليها أي قوائم مرتبطة.

4. **الالتفاف لاستكمال العدد**
   - إذا لم يتوافر ما يكفي من المشروعات الأقدم في نفس الموقع، يُعاد تنفيذ الاستعلامات بالمستويات نفسها لجلب مشروعات أحدث (بعد تاريخ المشروع الحالي) لاستكمال العدد إلى خمسة.
   - عند فقدان بيانات الموقع أو استمرار النقص، يتم استخدام مشروعات الفئة الرئيسية نفسها (بدون شرط الموقع) أولًا من الأقدم ثم من الأحدث لضمان عدم بقاء السكشن فارغًا.

5. **عرض النتائج**
   - بعد دمج النتائج وإزالة التكرارات، يقتصر السكشن على أول خمسة معرفات ويعرضها داخل شبكة بطاقات، ولا يتم طباعة أي HTML إذا لم تتوافر نتائج.

6. **مصدر عنوان السكشن**
   - يعتمد العنوان على اسم الفئة الرئيسية المخزن في جدول `property_categories`، مع صياغة عربية "مشروعات [اسم الفئة] في نفس المنطقة" أو ما يعادلها باللغة الإنجليزية.

عبر هذا التسلسل المرحلي بين مستويات الموقع والالتفاف إلى بقية المشروعات في نفس الفئة، نضمن وجود خمسة روابط قدر الإمكان لكل صفحة مشروع، وبذلك لا تبقى أي صفحة معزولة عن بقية كتالوج المشاريع.
